{% extends 'base.html' %}
{% load static %}

{% block title %}ëŒ€ì‹œë³´ë“œ - ì›¨ë”© í”Œë˜ë„ˆ{% endblock %}

{% block content %}
<style>
    .hero-bg {
        background: url('{% static "core/images/landing_bg.png" %}') center/cover;
        filter: brightness(0.7);
    }
</style>

<div class="row g-4 mb-5 fade-in">
    <!-- D-Day Hero Card -->
    <div class="col-12">
        <div class="card border-0 shadow-lg overflow-hidden text-white" style="border-radius: 20px;">
            <div class="card-body p-5 text-center position-relative">
                <div class="position-absolute top-0 start-0 w-100 h-100 hero-bg">
                </div>
                <div class="position-relative z-1">
                    <h5 class="fw-bold mb-3 letter-spacing-2 dashboard-header-text fs-4">WEDDING DAY</h5>
                    <h1 class="display-1 mb-0 dashboard-countdown fw-bold"
                        style="text-shadow: 2px 2px 4px rgba(0,0,0,0.2); font-size: 6rem;">
                        D-{{ d_day }}
                    </h1>
                    <p class="mt-3 fs-3 fw-bold opacity-100 font-refined"
                        style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                        {{ profile.user.username }}ë‹˜ì˜ ê²°í˜¼ì‹ì´ {{ d_day }}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-5 fade-in" style="animation-delay: 0.2s;">
    <!-- Calendar Section -->
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm glass-card h-100" style="border-radius: 20px;">
            <div class="card-header bg-transparent border-0 p-4 d-flex justify-content-between align-items-center">
                <a href="?year={{ prev_year }}&month={{ prev_month }}" class="btn btn-sm btn-light rounded-circle">
                    <i class="bi bi-chevron-left"></i>
                </a>
                <h4 class="fw-bold mb-0"><i class="bi bi-calendar-heart me-2 text-primary-custom"></i>
                    {{ current_year }}ë…„ {{ current_month }}ì›”</h4>
                <a href="?year={{ next_year }}&month={{ next_month }}" class="btn btn-sm btn-light rounded-circle">
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
            <div class="card-body p-4">
                <table class="calendar-table w-100">
                    <thead>
                        <tr>
                            <th class="text-danger">ì¼</th>
                            <th>ì›”</th>
                            <th>í™”</th>
                            <th>ìˆ˜</th>
                            <th>ëª©</th>
                            <th>ê¸ˆ</th>
                            <th class="text-primary">í† </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for week in calendar %}
                        <tr>
                            {% for day_info in week %}
                            <td>
                                {% if not day_info.is_empty %}
                                <div class="calendar-day {% if day_info.is_today %}today{% endif %} {% if day_info.is_selected %}selected{% endif %} {% if day_info.is_wedding_day %}wedding-day{% endif %}"
                                    onclick="selectDate(this, {{ current_year }}, {{ current_month }}, {{ day_info.day }})">
                                    <span>{{ day_info.day }}</span>
                                    {% if day_info.is_wedding_day %}
                                    <span class="fs-4">ğŸ’</span>
                                    {% endif %}
                                    {% if day_info.has_log %}
                                    <div class="event-dot"></div>
                                    {% endif %}
                                </div>
                                {% else %}
                                <div class="calendar-day empty"></div>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Daily Log Section -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm h-100 glass-card" style="border-radius: 20px;">
            <div class="card-header bg-transparent border-0 p-4">
                <h5 class="fw-bold mb-0"><i class="bi bi-journal-text me-2 text-primary-custom"></i>
                    {{ selected_date.month }}ì›” {{ selected_date.day }}ì¼ì˜ ê¸°ë¡</h5>
                <small class="text-muted" id="log-date-display">{{ selected_date.month }}ì›”
                    {{ selected_date.day }}ì¼</small>
            </div>
            <div class="card-body p-4 pt-0">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="date" value="{{ selected_date|date:'Y-m-d' }}">
                    <div class="mb-3">
                        <textarea name="log_content" class="form-control border-0 bg-light rounded-3 p-3" rows="8"
                            placeholder="ì˜¤ëŠ˜ ê²°í˜¼ ì¤€ë¹„í•˜ë©° ìˆì—ˆë˜ ì¼ì´ë‚˜ ìƒê°ì„ ê¸°ë¡í•´ë³´ì„¸ìš”..."
                            style="resize: none;">{{ current_log.content|default:'' }}</textarea>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 rounded-pill py-2 fw-bold shadow-sm">
                        <i class="bi bi-save me-2"></i>ì €ì¥í•˜ê¸°
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-5 fade-in" style="animation-delay: 0.4s;">
    <!-- Upcoming Tasks -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm h-100" style="border-radius: 20px;">
            <div class="card-header bg-white border-0 p-4">
                <h5 class="fw-bold mb-0">ì´ë²ˆ ì£¼ í•  ì¼</h5>
            </div>
            <div class="card-body p-4 pt-0">
                {% if upcoming_tasks %}
                <div class="list-group list-group-flush">
                    {% for task in upcoming_tasks %}
                    <div class="list-group-item border-0 px-0 py-3 d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="rounded-circle bg-soft text-primary-custom d-flex align-items-center justify-content-center"
                                style="width: 40px; height: 40px;">
                                <i class="bi bi-check-lg"></i>
                            </div>
                        </div>
                        <div class="ms-3 flex-grow-1">
                            <h6 class="mb-1 fw-bold">{{ task.title }}</h6>
                            <small class="text-muted">{{ task.date|date:"mì›” dì¼" }} (D-{{ task.d_day_offset }})</small>
                        </div>
                        <button class="btn btn-sm btn-outline-light text-muted rounded-circle">
                            <i class="bi bi-three-dots-vertical"></i>
                        </button>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-calendar-check display-4 mb-3 opacity-25"></i>
                    <p>ì´ë²ˆ ì£¼ëŠ” ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Vendor Status -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm h-100" style="border-radius: 20px;">
            <div class="card-header bg-white border-0 p-4">
                <h5 class="fw-bold mb-0">ì—…ì²´ ì¤€ë¹„ í˜„í™©</h5>
            </div>
            <div class="card-body p-4 pt-0">
                <div class="row g-3">
                    <div class="col-6">
                        <a href="{% url 'vendor_list' %}?category=venue" class="text-decoration-none">
                            <div
                                class="p-3 rounded-4 border-0 text-center transition-hover {% if vendor_status.venue %}bg-soft-success text-success{% else %}bg-light text-muted{% endif %}">
                                <i class="bi bi-building fs-1 mb-2 d-block"></i>
                                <span class="fw-bold small">ì˜ˆì‹ì¥</span>
                                {% if vendor_status.venue %}<i class="bi bi-check-circle-fill ms-1"></i>{% endif %}
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'vendor_list' %}?category=studio" class="text-decoration-none">
                            <div
                                class="p-3 rounded-4 border-0 text-center transition-hover {% if vendor_status.studio %}bg-soft-success text-success{% else %}bg-light text-muted{% endif %}">
                                <i class="bi bi-camera fs-1 mb-2 d-block"></i>
                                <span class="fw-bold small">ìŠ¤íŠœë””ì˜¤</span>
                                {% if vendor_status.studio %}<i class="bi bi-check-circle-fill ms-1"></i>{% endif %}
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'vendor_list' %}?category=dress" class="text-decoration-none">
                            <div
                                class="p-3 rounded-4 border-0 text-center transition-hover {% if vendor_status.dress %}bg-soft-success text-success{% else %}bg-light text-muted{% endif %}">
                                <i class="bi bi-person-heart fs-1 mb-2 d-block"></i>
                                <span class="fw-bold small">ë“œë ˆìŠ¤</span>
                                {% if vendor_status.dress %}<i class="bi bi-check-circle-fill ms-1"></i>{% endif %}
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'vendor_list' %}?category=makeup" class="text-decoration-none">
                            <div
                                class="p-3 rounded-4 border-0 text-center transition-hover {% if vendor_status.makeup %}bg-soft-success text-success{% else %}bg-light text-muted{% endif %}">
                                <i class="bi bi-brush fs-1 mb-2 d-block"></i>
                                <span class="fw-bold small">ë©”ì´í¬ì—…</span>
                                {% if vendor_status.makeup %}<i class="bi bi-check-circle-fill ms-1"></i>{% endif %}
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{{ current_year|json_script:"current-year-data" }}
<script>
    function selectDate(element, year, month, day) {
        // Construct the date string YYYY-MM-DD

        // Pad month and day with leading zeros if needed
        const monthStr = month.toString().padStart(2, '0');
        const dayStr = day.toString().padStart(2, '0');
        const dateStr = `${year}-${monthStr}-${dayStr}`;

        // Reload page with selected date, keeping the current calendar view
        window.location.href = `?date=${dateStr}&year=${year}&month=${month}`;
    }
</script>
{% endblock %}
{% extends "base.html" %}
{% load static %}

{% block title %}{{ post.title }} - 커뮤니티{% endblock %}

{% block content %}
<!-- Navigation Tabs -->
{% include 'weddings/includes/_dashboard_tabs.html' %}

<!-- ═══════════════════════════════════════════════════════════
     POST DETAIL — Glassmorphism Redesign (Distinct Blocks)
     ═══════════════════════════════════════════════════════════ -->

<div class="mb-8">
    <!-- Back Button -->
    <a href="{% url 'community_main' %}"
        class="inline-flex items-center gap-1.5 mb-4 text-sm text-gray-500 hover:text-pink-400 transition-colors no-underline">
        <i class="bi bi-arrow-left"></i> 커뮤니티로 돌아가기
    </a>

    <!-- Post Card -->
    <div class="rounded-[24px] overflow-hidden shadow-sm mb-5" style="box-shadow: 0 8px 32px rgba(255,142,142,0.06);">

        <!-- Post Header — Dark gradient for clear separation -->
        <div class="px-6 py-5"
            style="background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);position:relative;overflow:hidden;">
            <div
                style="position:absolute;inset:0;background-image:radial-gradient(circle at 1px 1px,rgba(255,255,255,0.03) 1px,transparent 0);background-size:24px 24px;">
            </div>
            <div style="position:relative;z-index:2;">
                <h1 class="text-lg font-bold text-white m-0 mb-3">{{ post.title }}</h1>
                <div class="flex flex-wrap items-center gap-3 text-xs" style="color:rgba(255,255,255,0.6);">
                    <span class="flex items-center gap-1">
                        <i class="bi bi-person-circle" style="color:#FFB5B5;"></i>
                        {{ post.author.first_name|default:post.author.username }}
                    </span>
                    <span class="flex items-center gap-1">
                        <i class="bi bi-calendar3"></i>
                        {{ post.created_at|date:"Y.m.d H:i" }}
                    </span>
                    <span class="flex items-center gap-1">
                        <i class="bi bi-heart-fill" style="color:#FF8E8E;"></i>
                        추천 {{ post.recommendations.count }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Post Content — White background for contrast -->
        <div class="px-6 py-8 bg-white">
            <div class="text-sm text-gray-700 leading-relaxed whitespace-pre-wrap" style="min-height:120px;">{{post.content }}</div>
        </div>

        <!-- Post Actions — Lightest gray for visual distinction -->
        <div class="px-6 py-4 flex items-center justify-between"
            style="background:#f8f9fa;border-top:1px solid #f0f0f0;">
            <div class="flex items-center gap-2">
                <a href="{% url 'post_recommend' post.id %}"
                    class="inline-flex items-center gap-1.5 px-4 py-2 rounded-xl text-xs font-bold transition-all no-underline hover:-translate-y-0.5
                    {% if user in post.recommendations.all %}text-white{% else %}bg-white border border-gray-200 text-gray-500 hover:bg-pink-50 hover:text-pink-400 hover:border-pink-200{% endif %}"
                    {% if user in post.recommendations.all %}
                    style="background:linear-gradient(135deg,#FF8E8E,#ff7a7a);box-shadow:0 4px 12px rgba(255,142,142,0.25);"
                    {% endif %}>
                    <i class="bi bi-heart-fill"></i> 추천 {{ post.recommendations.count }}
                </a>
            </div>
            {% if user == post.author %}
            <div class="flex items-center gap-2">
                <a href="{% url 'post_edit' post.id %}"
                    class="inline-flex items-center gap-1 px-3 py-2 rounded-xl text-xs font-bold bg-white border border-gray-200 text-gray-500 hover:bg-blue-50 hover:text-blue-400 hover:border-blue-200 transition-all no-underline">
                    <i class="bi bi-pencil-square"></i> 수정
                </a>
                <form method="post" action="{% url 'post_delete' post.id %}" onsubmit="return confirm('정말 삭제하시겠습니까?');"
                    style="margin:0;">
                    {% csrf_token %}
                    <button type="submit"
                        class="inline-flex items-center gap-1 px-3 py-2 rounded-xl text-xs font-bold bg-white border border-gray-200 text-gray-500 hover:bg-red-50 hover:text-red-400 hover:border-red-200 transition-all cursor-pointer">
                        <i class="bi bi-trash3"></i> 삭제
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Comments Section -->
    <div class="rounded-[24px] bg-white/70 backdrop-blur-md border border-white/50 overflow-hidden shadow-sm"
        style="box-shadow: 0 8px 32px rgba(255,142,142,0.06);">
        <div class="px-6 py-4 border-b border-gray-100/60">
            <h5 class="text-sm font-bold text-gray-800 m-0 flex items-center gap-2">
                <i class="bi bi-chat-dots" style="color:#FF8E8E;"></i>
                댓글 <span class="text-xs text-gray-400 font-normal">({{ comments|length }})</span>
            </h5>
        </div>

        <!-- Comment Write Form -->
        <div class="px-6 py-4 border-b border-gray-100/30" style="background:rgba(255,142,142,0.02);">
            <form method="post" action="{% url 'comment_create' %}">
                {% csrf_token %}
                <input type="hidden" name="post_id" value="{{ post.id }}">
                <div class="flex gap-3">
                    <div class="flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center text-white text-xs font-bold"
                        style="background:linear-gradient(135deg,#FF8E8E,#FFB5B5);">
                        {{ user.first_name|default:user.username|truncatechars:1 }}
                    </div>
                    <div class="flex-1">
                        <textarea name="content" rows="2"
                            class="w-full bg-white/80 border border-gray-200 rounded-2xl px-4 py-3 text-sm text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-pink-200 focus:border-pink-300 transition-all resize-none"
                            placeholder="댓글을 작성해주세요..." required></textarea>
                        <div class="flex justify-end mt-2">
                            <button type="submit"
                                class="px-4 py-2 rounded-xl text-white text-xs font-bold transition-all hover:-translate-y-0.5"
                                style="background:linear-gradient(135deg,#FF8E8E,#ff7a7a);box-shadow:0 4px 12px rgba(255,142,142,0.25);">
                                <i class="bi bi-send mr-1"></i> 등록
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Comments List -->
        <div class="divide-y divide-gray-50">
            {% for comment in comments %}
            <div class="px-6 py-4 hover:bg-pink-50/20 transition-colors">
                <div class="flex gap-3">
                    <div
                        class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center bg-gray-100 text-gray-500 text-xs font-bold">
                        {{ comment.author.first_name|default:comment.author.username|truncatechars:1 }}
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-bold text-gray-700">{{ comment.author.first_name|default:comment.author.username }}</span>
                            <span class="text-[10px] text-gray-400">{{ comment.created_at|date:"Y.m.d H:i" }}</span>
                        </div>
                        <p class="text-sm text-gray-600 m-0 leading-relaxed">{{ comment.content }}</p>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-10 text-gray-400">
                <i class="bi bi-chat-left text-3xl mb-2 block opacity-30"></i>
                <p class="text-sm m-0">아직 댓글이 없습니다. 첫 번째 댓글을 남겨보세요!</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
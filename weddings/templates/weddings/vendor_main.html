{% extends "base.html" %}
{% load static humanize %}

{% block title %}업체 분석 - 웨딩 플래너{% endblock %}

{% block content %}
<!-- Navigation Tabs -->
{% include 'weddings/includes/_dashboard_tabs.html' %}

<!-- ═══════════════════════════════════════════════════════════
     VENDOR TAB — Glassmorphism Redesign (Sectioned Layout)
     ═══════════════════════════════════════════════════════════ -->

<!-- ─── Section 1: My Selected Vendors ─── -->
<section class="vendor-section reveal mb-10" data-reveal="fade-up">
    <!-- Section Divider Header -->
    <div class="text-center mb-6">
        <span class="inline-block px-4 py-1.5 rounded-full text-[10px] font-extrabold uppercase tracking-widest"
            style="background:linear-gradient(135deg,rgba(255,142,142,0.12),rgba(255,181,181,0.06));color:#FF8E8E;border:1px solid rgba(255,142,142,0.15);">
            <i class="bi bi-check-circle-fill mr-1"></i>My Vendors
        </span>
        <h3 class="text-xl font-extrabold text-gray-800 mt-3 mb-1">나의 선정 업체</h3>
        <p class="text-sm text-gray-400 m-0">최종 선정한 업체를 한눈에 확인하세요</p>
        <div class="mx-auto mt-4"
            style="width:60px;height:3px;border-radius:2px;background:linear-gradient(90deg,#FF8E8E,#FFB5B5);"></div>
    </div>

    {% if my_selected_vendors %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for selection in my_selected_vendors %}
        <div class="rounded-[20px] bg-white/80 backdrop-blur-md border border-white/60 p-5 shadow-md flex items-start gap-4 transition-all hover:shadow-xl hover:-translate-y-1"
            style="box-shadow: 0 4px 20px rgba(255,142,142,0.08);">
            <!-- Vendor Icon -->
            <div class="flex-shrink-0 w-12 h-12 rounded-2xl flex items-center justify-center text-white text-lg"
                style="background:linear-gradient(135deg,#FF8E8E,#FFB5B5);">
                <i class="bi bi-shop"></i>
            </div>
            <!-- Vendor Info -->
            <div class="flex-1 min-w-0">
                <h4 class="text-sm font-bold text-gray-800 m-0 truncate">{{ selection.vendor.name }}</h4>
                <p class="text-xs text-gray-400 m-0 mt-0.5">
                    <i class="bi bi-tag-fill mr-1" style="color:#FF8E8E;"></i>{{ selection.vendor.category.name }}
                </p>
                {% if selection.vendor.price_range %}
                <span
                    class="inline-flex items-center gap-1 mt-2 px-2.5 py-1 rounded-full bg-green-50 text-green-600 text-[10px] font-bold border border-green-100">
                    <i class="bi bi-currency-exchange"></i>{{ selection.vendor.price_range }}
                </span>
                {% endif %}
            </div>
            <span
                class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-emerald-50 text-emerald-500 text-[10px] font-bold border border-emerald-100">
                <i class="bi bi-check-circle-fill"></i> 선정
            </span>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="rounded-[24px] bg-white/60 backdrop-blur-md border border-white/50 py-12 text-center shadow-sm">
        <i class="bi bi-shop text-5xl mb-3 block" style="color:#FFB5B5;opacity:0.4;"></i>
        <p class="text-sm text-gray-400 m-0">아직 선정한 업체가 없습니다.</p>
        <p class="text-xs text-gray-300 mt-1">아래 카테고리에서 업체를 비교하고 선정하세요</p>
    </div>
    {% endif %}
</section>


<!-- ─── Visual Section Divider ─── -->
<div class="flex items-center gap-4 my-10">
    <div class="flex-1 h-px" style="background:linear-gradient(90deg,transparent,rgba(255,142,142,0.2),transparent);">
    </div>
    <i class="bi bi-diamond-fill text-[8px]" style="color:#FFB5B5;"></i>
    <div class="flex-1 h-px" style="background:linear-gradient(90deg,transparent,rgba(255,142,142,0.2),transparent);">
    </div>
</div>


<!-- ─── Section 2: Vendor Categories ─── -->
<section class="vendor-section reveal mb-10" data-reveal="fade-up">
    <div class="text-center mb-6">
        <span class="inline-block px-4 py-1.5 rounded-full text-[10px] font-extrabold uppercase tracking-widest"
            style="background:linear-gradient(135deg,rgba(99,145,255,0.12),rgba(130,170,255,0.06));color:#6391FF;border:1px solid rgba(99,145,255,0.15);">
            <i class="bi bi-grid-3x3-gap-fill mr-1"></i>Categories
        </span>
        <h3 class="text-xl font-extrabold text-gray-800 mt-3 mb-1">업체 카테고리</h3>
        <p class="text-sm text-gray-400 m-0">카테고리별로 업체를 탐색하세요</p>
        <div class="mx-auto mt-4"
            style="width:60px;height:3px;border-radius:2px;background:linear-gradient(90deg,#6391FF,#82AAFF);"></div>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
        {% for category in vendor_categories %}
        <a href="#"
            class="group block rounded-[20px] bg-white/80 backdrop-blur-md border border-white/60 p-5 text-center shadow-md transition-all hover:shadow-xl hover:-translate-y-2 hover:bg-white/95 no-underline"
            style="box-shadow: 0 4px 20px rgba(0,0,0,0.04);">
            <div class="w-14 h-14 mx-auto rounded-2xl flex items-center justify-center mb-3 transition-all group-hover:scale-110"
                style="background:linear-gradient(135deg,rgba(255,142,142,0.12),rgba(255,181,181,0.06));">
                {% if category.name == '예식장' %}
                <i class="bi bi-buildings text-xl" style="color:#FF8E8E;"></i>
                {% elif category.name == '스튜디오' %}
                <i class="bi bi-camera-fill text-xl" style="color:#FF8E8E;"></i>
                {% elif category.name == '드레스' %}
                <i class="bi bi-flower1 text-xl" style="color:#FF8E8E;"></i>
                {% elif category.name == '메이크업' %}
                <i class="bi bi-palette-fill text-xl" style="color:#FF8E8E;"></i>
                {% elif category.name == '상견례장소' %}
                <i class="bi bi-cup-hot-fill text-xl" style="color:#FF8E8E;"></i>
                {% elif category.name == '한복' %}
                <i class="bi bi-person-standing-dress text-xl" style="color:#FF8E8E;"></i>
                {% else %}
                <i class="bi bi-shop text-xl" style="color:#FF8E8E;"></i>
                {% endif %}
            </div>
            <h4 class="text-sm font-bold text-gray-700 m-0">{{ category.name }}</h4>
            <p class="text-[10px] text-gray-400 m-0 mt-1">{{ category.vendor_set.count }}개 업체</p>
        </a>
        {% endfor %}
    </div>
</section>


<!-- ─── Visual Section Divider ─── -->
<div class="flex items-center gap-4 my-10">
    <div class="flex-1 h-px" style="background:linear-gradient(90deg,transparent,rgba(255,142,142,0.2),transparent);">
    </div>
    <i class="bi bi-diamond-fill text-[8px]" style="color:#FFB5B5;"></i>
    <div class="flex-1 h-px" style="background:linear-gradient(90deg,transparent,rgba(255,142,142,0.2),transparent);">
    </div>
</div>


<!-- ─── Section 3: Recommended Vendors ─── -->
<section class="vendor-section reveal mb-10" data-reveal="fade-up">
    <div class="text-center mb-6">
        <span class="inline-block px-4 py-1.5 rounded-full text-[10px] font-extrabold uppercase tracking-widest"
            style="background:linear-gradient(135deg,rgba(255,184,77,0.12),rgba(255,210,135,0.06));color:#F59E0B;border:1px solid rgba(255,184,77,0.15);">
            <i class="bi bi-star-fill mr-1"></i>Recommended
        </span>
        <h3 class="text-xl font-extrabold text-gray-800 mt-3 mb-1">추천 업체</h3>
        <p class="text-sm text-gray-400 m-0">인기 있는 웨딩 업체를 확인하세요</p>
        <div class="mx-auto mt-4"
            style="width:60px;height:3px;border-radius:2px;background:linear-gradient(90deg,#F59E0B,#FBBF24);"></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for vendor in recommended_vendors %}
        <div class="rounded-[20px] bg-white/80 backdrop-blur-md border border-white/60 overflow-hidden shadow-md transition-all hover:shadow-xl hover:-translate-y-1"
            style="box-shadow: 0 4px 20px rgba(0,0,0,0.05);">
            {% if vendor.image %}
            <div class="h-36 overflow-hidden">
                <img src="{{ vendor.image.url }}" alt="{{ vendor.name }}"
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-500">
            </div>
            {% else %}
            <div class="h-36 flex items-center justify-center"
                style="background:linear-gradient(135deg,rgba(255,142,142,0.05),rgba(255,181,181,0.08));">
                <i class="bi bi-image text-4xl" style="color:#FFB5B5;opacity:0.4;"></i>
            </div>
            {% endif %}
            <div class="p-4">
                <div class="flex items-center justify-between gap-2 mb-1">
                    <h4 class="text-sm font-bold text-gray-800 m-0 truncate">{{ vendor.name }}</h4>
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[9px] font-bold"
                        style="background:rgba(255,142,142,0.1);color:#FF8E8E;">
                        <i class="bi bi-tag-fill"></i>{{ vendor.category.name }}
                    </span>
                </div>
                {% if vendor.price_range %}
                <p class="text-xs text-gray-500 m-0 flex items-center gap-1">
                    <i class="bi bi-wallet2" style="color:#FF8E8E;"></i> {{ vendor.price_range }}
                </p>
                {% endif %}
                {% if vendor.region %}
                <p class="text-xs text-gray-400 m-0 mt-0.5 flex items-center gap-1">
                    <i class="bi bi-geo-alt"></i> {{ vendor.region }}
                </p>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div
            class="col-span-2 rounded-[24px] bg-white/60 backdrop-blur-md border border-white/50 py-12 text-center shadow-sm">
            <i class="bi bi-stars text-5xl mb-3 block" style="color:#FFB5B5;opacity:0.4;"></i>
            <p class="text-sm text-gray-400 m-0">추천 업체가 아직 없습니다.</p>
        </div>
        {% endfor %}
    </div>
</section>

<style>
    .vendor-section {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .vendor-section.revealed {
        opacity: 1;
        transform: translateY(0);
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const sections = document.querySelectorAll('.vendor-section.reveal');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('revealed'); observer.unobserve(entry.target); } });
        }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
        sections.forEach(s => observer.observe(s));
    });
</script>
{% endblock %}